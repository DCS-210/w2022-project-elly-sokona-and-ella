

```{r load-data, echo = FALSE} 
library(readr)
library(tidyverse)
library(forcats)

district_demographics <- read_csv("https://raw.githubusercontent.com/invinst/chicago-police-data/master/data/context_data/district_demographics/Districts.csv")

active_duty_officers <- read_csv("https://raw.githubusercontent.com/invinst/chicago-police-data/master/data/context_data/CPD%20Employees%20active-duty-only.csv")

#The officers accused
complaints_accused <- read_csv("data/complaints-accused_2000-2016_2016-11.csv")

#those who made the complaints
complainants <- read_csv("data/complaints-complainants_2000-2016_2016-11 (1).csv")

#What complaints were made (more categorical data)
complaints_made <- read_csv("data/complaints-complaints_2000-2016_2016-11 (1).csv")

units <- read.csv("https://raw.githubusercontent.com/invinst/chicago-police-data/master/data/context_data/current_and_past_units/Current_and_Past_CPD_Units_2016-05-06.csv")
```


```{r data-joins}
district_complaints <- complaints_accused %>%
  filter(current_unit %in% 1:25) %>%
  group_by(current_unit) %>%
  summarise(n = n()) %>%
  arrange(desc(n))

total_district_complaints <- full_join(district_complaints,
                                       district_demographics,
                                       by = c("current_unit" = "District_No")) %>%
  mutate(complaints_per_capita = n/Population)

total_district_complaints %>%
  arrange(desc(complaints_per_capita)) %>%
  factor(total_district_complaints$District_Name) %>%
  ggplot(data = total_district_complaints, mapping = aes(x = District_Name,
                       y = order(total_district_complaints$complaints_per_capita), 
                       color = Majority)) + geom_point() +
    coord_flip()
  


#forcats package, reorder() function, look at forcat cheestsheet, fct_reorder


```

ggplot(data = total_district_complaints,
       mapping = aes(x = District_Name,
                     y = n,
                     color = Majority)) +
  geom_point() +
  coord_flip()
  
  
```{r}
skimr::skim(complaints_accused)
```
  
```{r}
district_complaints_1 <- complaints_accused %>%
  filter(current_unit %in% 1:25) %>%
  group_by(current_unit)

  #summarise(n = n()) %>%
  #arrange(desc(n))

total_district_complaints_findings <- full_join(district_complaints_1,
                                       district_demographics,
                                       by = c("current_unit" = "District_No"))


#stat = "identity"


#FIX ERROR, CHECK IF FINAL FINDING IS A CHARACTER
data1 <- total_district_complaints_findings %>%
  group_by(final_finding, District_Name) %>%
  summarize(n = n()) %>%
  mutate(final_decision = case_when(
    final_finding %in% "SU" ~ "Sustained",
    final_finding %in% "NA" ~ "Missing"))


 #reorder disciplined and sustained findings vs those who didn't make the next stage (case_when)
 
#NAF = NO AFFIVADIT
#NC = NO COOPERATION


 ggplot(data = data1,  aes(fill = final_decision,
             x = District_Name,
             y = n)
         ) +
  geom_bar(position = "fill", stat = "identity") +
   theme_minimal() +
  scale_fill_viridis_d() +
  coord_flip() +
   labs(title = "Proportion of Final Findings",
        subtitle = "By Neighborhood",
        x = "Proportion of Complaints",
        y = "District Name"
        )
  
  


 
 

```
  
  
  
  
```{r}
data1 <- total_district_complaints_findings %>%
  group_by(final_finding, District_Name) %>%
  summarize(n = n()) %>%
  mutate(final_decision = case_when(final_finding == "DIS" ~ "Sustained"))
```
  
  
```{r}
library(leaflet)
library(dplyr)

 #Insert your latitude and longitude in the code below
# NOTE: Don't get them reversed otherwise you'll end up in the South Pole.

# Initialize and assign m as the leaflet object
m <- leaflet() %>%
# Now add tiles to it
 addTiles() %>%
# Setting the middle of where the map should be and the zoom level
  setView(-87.633506, 41.876067, zoom = 13)
# Now, add a marker with a popup, 
    #addMarkers(lng=41.793278, lat=-87.732528)

#41.793278, -87.732528
m


#x <- leaflet() %>%
 # addTiles() %>%
  #setView(lng = 41.854627, lat = -87.617837, zoom = 5)

#mymap <- m %>%   
 # addTiles('http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg', attribution = 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>') %>% setView(-87.732528, 41.793278, zoom = 4)
  


#download boundary map of chicago as shapefile, and upload the file, (as a zip)
```
  
  
  
```{r}
library()
```
  
  